<filter wpcli.**>
  @type parser
  format json
  key_name message
  reserve_data true
</filter>

<filter wpcli.**>
  @type record_transformer
  remove_keys pid,msgid,extradata,message,ident,pri,facility,priority,pid,aggr_cluster
</filter>

<match wpcli.**>
  @type bigquery
  method          insert
  flush_interval  1
  buffer_chunk_limit            1M
  buffer_chunk_records_limit    200     # rate limit is 500
  buffer_queue_limit            10240   # 1MB * 10240 -> 10GB!
  auth_method json_key
  json_key    /etc/td-agent/key.json

  project   {{ fluentd_project }}
  dataset   {{ fluentd_wpcli_dataset }}

  tables commands
  time_field    time
</match>